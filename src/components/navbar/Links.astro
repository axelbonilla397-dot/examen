---
import { Icon } from "astro-icon/components";

const categories = [
    { name: "Inicio", href: "/" },
    { name: "Cat√°logo", 
        href: "#",
        subcategories: [
            { name: "Sedanes", href: "/category/sedan" },
            { name: "SUVs", href: "/category/suv" },
            { name: "Camionetas", href: "/category/pickup" },
            { name: "Deportivos", href: "/category/lujo" }
    ]
  },
    { name: "Ofertas del mes", href: "/oferta" }, 
    { name: "Financiamiento", href: "/category/financiamiento" }, 
];

---

<div class="bg-primary text-primary-content shadow-sm relative z-40">
    <div
        class="max-w-7xl mx-auto flex justify-between items-center text-xs sm:text-sm font-medium h-10"
    >
        <!-- Mobile: Categories Button -->
        <div
            class="flex sm:hidden w-full items-center justify-between h-full px-4"
        >
            <button
                id="mobile-links-toggle"
                class="flex items-center gap-2 h-full px-2 hover:bg-white/10 transition-colors cursor-pointer"
            >
                <span>Categories</span>
                <Icon
                    name="lucide:chevron-down"
                    id="chevron-icon"
                    class="w-4 h-4 transition-transform duration-300"
                />
            </button>

            <div class="flex h-full items-center">
                <a
                    href="/contact"
                    class="flex items-center h-full px-2 hover:bg-white/10 transition-colors"
                    >Contact</a
                >
            </div>
        </div>

        <!-- Desktop: Left Side (Mapped Categories) -->
        <div class="hidden sm:flex h-full items-center">
            {
                categories.map((cat) =>
                    cat.subcategories ? (
                        <div class="dropdown dropdown-hover h-full">
                            <div
                                tabindex="0"
                                role="button"
                                class="flex items-center h-full px-4 hover:bg-white/10 text-white/90 hover:text-white transition-all cursor-pointer gap-1"
                            >
                                {cat.name}
                                <Icon
                                    name="lucide:chevron-down"
                                    class="w-3 h-3 opacity-70"
                                />
                            </div>
                            <ul
                                tabindex="0"
                                class="dropdown-content menu bg-base-100 rounded-box z-50 w-48 p-2 shadow-lg text-base-content border border-base-200"
                            >
                                {cat.subcategories.map((sub) => (
                                    <li>
                                        <a
                                            href={sub.href}
                                            class="hover:bg-primary/10 transition-colors"
                                        >
                                            {sub.name}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    ) : (
                        <a
                            href={cat.href}
                            class="flex items-center h-full px-4 hover:bg-white/10 text-white/90 hover:text-white transition-all cursor-pointer"
                        >
                            {cat.name}
                        </a>
                    ),
                )
            }
        </div>

        <!-- Desktop: Right Side -->
        <div class="hidden sm:flex h-full items-center">
            <a
                href="/about"
                class="flex items-center h-full px-4 hover:bg-white/10 text-white/90 hover:text-white transition-all cursor-pointer"
                >Sobre nosotros</a
            >

            <a
                href="/contact"
                class="flex items-center h-full px-4 hover:bg-white/10 text-white/90 hover:text-white transition-all cursor-pointer"
                >Contacto</a
            >
            <a
                href="https://wa.me/50498354093?text=Hola,%20quiero%20cotizar%20un%20vehiculo"
                target="_blank"
                class="ml-4 mr-2 btn btn-success btn-sm text-white font-semibold hover:scale-105 transition-transform"
            >
                Cotizar por WhatsApp
            </a>

        </div>
    </div>

    <!-- Mobile Dropdown Menu -->
    <div
        id="mobile-links-menu"
        class="sm:hidden grid grid-rows-[0fr] transition-[grid-template-rows] duration-300 ease-in-out bg-primary overflow-hidden brightness-95"
    >
        <div class="min-h-0 flex flex-col border-t border-white/10">
            {
                categories.map((cat) => (
                    <>
                        <a
                            href={cat.href}
                            class="py-3 px-6 hover:bg-white/10 border-b border-white/5 transition-colors flex justify-between items-center group"
                        >
                            {cat.name}
                            {cat.subcategories && (
                                <span class="text-[10px] opacity-40 uppercase font-bold italic">
                                    Browse
                                </span>
                            )}
                        </a>
                        {cat.subcategories && (
                            <div class="bg-primary/30 flex flex-col">
                                {cat.subcategories.map((sub) => (
                                    <a
                                        href={sub.href}
                                        class="py-2.5 pl-12 pr-6 hover:bg-white/10 border-b border-white/5 text-xs text-white/80 transition-colors"
                                    >
                                        {sub.name}
                                    </a>
                                ))}
                            </div>
                        )}
                    </>
                ))
            }
            <div
                class="bg-primary/50 py-2 px-6 text-white/60 uppercase text-[10px] tracking-widest font-bold"
            >
                More Info
            </div>
            <a
                href="/about"
                class="py-3 px-6 hover:bg-white/10 border-b border-white/5 transition-colors"
                >About Us</a
            >
            <a
                href="/blog"
                class="py-3 px-6 hover:bg-white/10 border-b border-white/5 transition-colors"
                >Our Blog</a
            >
        </div>
    </div>
</div>

<script>
    const setupToggle = () => {
        const toggleBtn = document.getElementById("mobile-links-toggle");
        const menu = document.getElementById("mobile-links-menu");
        const chevron = document.getElementById("chevron-icon");

        if (toggleBtn && menu && chevron) {
            toggleBtn.addEventListener("click", () => {
                const isOpen = menu.classList.contains("grid-rows-[1fr]");

                if (isOpen) {
                    menu.classList.remove("grid-rows-[1fr]");
                    menu.classList.add("grid-rows-[0fr]");
                    chevron.classList.remove("rotate-180");
                } else {
                    menu.classList.remove("grid-rows-[0fr]");
                    menu.classList.add("grid-rows-[1fr]");
                    chevron.classList.add("rotate-180");
                }
            });
        }
    };

    setupToggle();
    document.addEventListener("astro:after-swap", setupToggle);
</script>
